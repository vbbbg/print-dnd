### 分页打印 Implementation

目前的实现逻辑如下：

#### 1. 分页核心逻辑

- **计算可用高度**:
  - 系统首先确定页面的可用**表格区域高度**。
  - 计算公式：`AvailableHeight = FooterTopY - BodyTopY`。
  - `FooterTopY`: 取所有页脚元素（Footer Items）中 `y` 坐标最小的值。如果没有页脚元素，则默认预留底部 20mm 边距。
  - `BodyTopY`: 模板中定义的表格起始 `y` 坐标。

- **计算每页行数**:
  - 使用预估的行高 `ESTIMATED_ROW_HEIGHT_MM` (目前设定为 10mm)。
  - `RowsPerPage = Math.floor(AvailableHeight / 10mm)`。
  - 如果开启了 **页小计 (showSubtotal)**，`RowsPerPage` 会自动减 1 以预留空间。

- **数据切分**:
  - 根据 `RowsPerPage` 将表格数据列表 (`data.list`) 切分成多个块 (Chunks)。
  - 每个块对应生成一个 PDF 页面。

#### 2. 页面元素渲染规则

对于生成的每一页（`.page` 容器）：

- **页眉 (Header)**: 在每一页都会重复渲染。
- **主标题 (Title)**: 在每一页都会重复渲染。
- **页脚 (Footer)**: 在每一页都会重复渲染。
- **表格 (Table)**:
  - **表头 (Thead)**: 在每一页的表格中都会重复显示，保证上下文清晰。
  - **表体 (Tbody)**: 仅显示当前页面对应的数据块。
  - **页小计 (Page Subtotal)**:
    - 开启 `showSubtotal` 时，在**每一页**表格底部显示。
    - **自动计算**: 自动累加当前页面数据的数值。
    - **布局**: 严格按照表格列布局，不进行合并单元格，保持列对齐。
    - **内容**: 第一列显示 "小计"，包含 "quantity" 或 "amount" 的列显示计算结果。
  - **合计行 (Grand Total)**:
    - 开启 `showTotal` 时，**仅在最后一页**表格底部显示。
    - **自动计算**: 自动累加**所有页面**数据的数值。
    - **布局**: 同上，严格按照表格列布局。
    - **内容**: 第一列显示 "合计"，包含 "quantity" 或 "amount" 的列显示计算结果。

#### 3. 自动汇总与布局细节

- **列对齐**: 小计和合计行不再跨列合并，而是为每一列渲染独立的 `<td>`，确保边框和内容与上方的数据列完美对齐。
- **自动识别字段**:
  - **数量 (Quantity)**: 匹配列名包含 `quantity` 的字段。直接显示累加值。
  - **金额 (Amount/Price)**: 匹配列名包含 `amount` 或 `price` 的字段。显示累加值并保留 **2位小数**。
- **标签显示**: "小计" 和 "合计" 文本默认固定显示在表格的**第一列**。

#### 4. 技术实现细节

- 使用 HTML/CSS 进行物理分页。
- 每个页面被包裹在 `<div class="page">` 中。
- CSS 样式 `.page { page-break-after: always; }` 确保打印时强制分页。
- 最后一页使用 `page-break-after: auto`。
- **高度计算**: 如果开启 `showSubtotal`，每页计算最大行数时会预留 1 行的高度，防止内容溢出。
